/*!
Spot.js: load a CSS files asynchronously and cache it in localStorage
(c) 2015 Andrew Shapel
Licensed MIT
*/
!function(a,b){"use strict";function c(a){this.config=a||{},this.config.stylesheets=this.config.stylesheets||{}}c.prototype.configure=function(a){a.baseUrl=a.baseUrl&&"/"!=a.baseUrl[a.baseUrl.length-1]?a.baseUrl+"/":a.baseUrl;var b={};if(a.stylesheets)for(var c in a.stylesheets)a.stylesheets.hasOwnProperty(c)&&(b[c]={href:(a.baseUrl||String())+a.stylesheets[c],options:{}});if(a.options)for(var d in a.options)a.options.hasOwnProperty(d)&&b.hasOwnProperty(d)&&(b[d].options=a.options[d]);this.config.baseUrl=a.baseUrl||String(),this.config.stylesheets=b||{}},c.prototype.addStylesheet=function(a,b,c,d,e){var f=this,g=new XMLHttpRequest;g.onload=function(){200==g.status&&f.addStylesheetRules(g.responseText,a,b,c,d,e)},g.open("GET",a,!0),g.send()},c.prototype.addStylesheetRules=function(b,c,d,e,f,g){var h=a.document.createElement("style"),i=f||a.document.querySelectorAll("script")[0];return h.type="text/css",h.title=d,h.media="only x",h.setAttribute("data-href",c),h.styleSheet?h.styleSheet.cssText=b:h.appendChild(a.document.createTextNode(b)),i.parentNode.insertBefore(h,i),this.setMedia(h,e),g&&g(h,b),h},c.prototype.findInLocalStorage=function(b,c){var d=a.localStorage.getItem(b)||a.localStorage.getItem(c);return d&&d.length>0&&(d=JSON.parse(d)),d},c.prototype.setMedia=function(a,b){a.sheet?a.media=b||"all":setTimeout(function(){setMedia(a,b)},1)},c.prototype.isLocalStorageSupports=function(){return a.hasOwnProperty("localStorage")&&null!==a.localStorage?!0:!1},c.prototype.saveInLocalStorage=function(b,c,d,e,f){var g=(new Date).getHours(),h=new Date;h.setHours(g+f);var i=b||c,j={name:i,href:c,media:d,stylesheet:e,timeStamp:(new Date).getTime().toString(),expireStamp:h.getTime().toString()};a.localStorage.setItem(i,JSON.stringify(j))},c.prototype.cssAsyncLoad=function(a,c,d){var c=c||{},e=c.name||String(),f=c.before||null,g=c.media||null,h=c.expire||1,i=this,j=b.querySelector('style[data-href="'+a+'"]');if(!j&&this.isLocalStorageSupports){var k=this.findInLocalStorage(e,a);!k||k&&(new Date).getTime().toString()>k.expireStamp?this.addStylesheet(a,e,g,f,function(b,c){i.saveInLocalStorage(e,a,g,c,h),d&&d(b)}):k&&(new Date).getTime().toString()<k.expireStamp&&this.addStylesheetRules(k.stylesheet,a,k.name,k.media,f,function(a){d&&d(a)})}},c.prototype.load=function(a,b){var c=this,d=[];a.forEach(function(a){"string"==typeof a&&c.config.stylesheets.hasOwnProperty(a)?c.cssAsyncLoad(c.config.stylesheets[a].href,c.config.stylesheets[a].options,function(a){d.push(a)}):c.cssAsyncLoad(a.href,a.options,function(a){d.push(a)})}),b&&d.length>0&&b.apply(null,d)},a.Spot=new c}(this,document);
